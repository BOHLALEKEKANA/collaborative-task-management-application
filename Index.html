<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Task Manager</h1>
        
        <!-- Add Task Form -->
        <div class="mb-4">
            <input id="taskTitle" type="text" placeholder="Task Title" class="border p-2 mr-2">
            <input id="taskDesc" type="text" placeholder="Description" class="border p-2 mr-2">
            <select id="taskStatus" class="border p-2 mr-2">
                <option value="TODO">To Do</option>
                <option value="IN_PROGRESS">In Progress</option>
                <option value="DONE">Done</option>
            </select>
            <input id="taskUser" type="text" placeholder="Assigned To" class="border p-2 mr-2">
            <button onclick="addTask()" class="bg-blue-500 text-white p-2 rounded">Add Task</button>
        </div>

        <!-- Task List -->
        <div id="taskList" class="grid gap-4">
            <!-- Tasks will be dynamically added here -->
        </div>
    </div>

    <script>
        const socket = io('http://localhost:5000');

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('initial_tasks', (tasks) => {
            tasks.forEach(addTaskToUI);
        });

        socket.on('task_added', (task) => {
            addTaskToUI(task);
        });

        socket.on('task_updated', (task) => {
            updateTaskInUI(task);
        });

        socket.on('task_deleted', (data) => {
            document.getElementById(`task-${data.id}`).remove();
        });

        function addTask() {
            const task = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDesc').value,
                status: document.getElementById('taskStatus').value,
                assignedTo: { username: document.getElementById('taskUser').value }
            };
            socket.emit('add_task', task);
            clearForm();
        }

        function updateTask(id) {
            const taskElement = document.getElementById(`task-${id}`);
            const task = {
                id: id,
                title: taskElement.querySelector('.title').value,
                description: taskElement.querySelector('.description').value,
                status: taskElement.querySelector('.status').value,
                assignedTo: { username: taskElement.querySelector('.assignedTo').value }
            };
            socket.emit('update_task', task);
        }

        function deleteTask(id) {
            socket.emit('delete_task', id);
        }

        function addTaskToUI(task) {
            const taskList = document.getElementById('taskList');
            const taskDiv = document.createElement('div');
            taskDiv.id = `task-${task.id}`;
            taskDiv.className = 'bg-white p-4 rounded shadow';
            taskDiv.innerHTML = `
                <input class="title border p-2 mb-2 w-full" value="${task.title}">
                <textarea class="description border p-2 mb-2 w-full">${task.description}</textarea>
                <select class="status border p-2 mb-2 w-full">
                    <option value="TODO" ${task.status === 'TODO' ? 'selected' : ''}>To Do</option>
                    <option value="IN_PROGRESS" ${task.status === 'IN_PROGRESS' ? 'selected' : ''}>In Progress</option>
                    <option value="DONE" ${task.status === 'DONE' ? 'selected' : ''}>Done</option>
                </select>
                <input class="assignedTo border p-2 mb-2 w-full" value="${task.assignedTo ? task.assignedTo.username : ''}">
                <div class="flex gap-2">
                    <button onclick="updateTask(${task.id})" class="bg-green-500 text-white p-2 rounded">Update</button>
                    <button onclick="deleteTask(${task.id})" class="bg-red-500 text-white p-2 rounded">Delete</button>
                </div>
            `;
            taskList.appendChild(taskDiv);
        }

        function updateTaskInUI(task) {
            const taskElement = document.getElementById(`task-${task.id}`);
            taskElement.querySelector('.title').value = task.title;
            taskElement.querySelector('.description').value = task.description;
            taskElement.querySelector('.status').value = task.status;
            taskElement.querySelector('.assignedTo').value = task.assignedTo ? task.assignedTo.username : '';
        }

        function clearForm() {
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDesc').value = '';
            document.getElementById('taskStatus').value = 'TODO';
            document.getElementById('taskUser').value = '';
        }
    </script>
</body>
</html>
